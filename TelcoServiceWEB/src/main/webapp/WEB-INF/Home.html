<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<meta charset="ISO-8859-1">

<link rel="stylesheet" type="text/css" media="all"
      href="../CSS/mystyle.css" th:href="@{/css/mystyle.css}"/>
<link
        rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
/>
<link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css"
/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
<script src="js/script.js"></script>

<title>Home</title>
<div align="right" th:if="${session.user != null}">
    <p th:text="${'Hello, ' + session.user.username }"></p>
    <a th:href="@{/Logout}">Logout</a>
</div>
<div align="right" th:if="${session.user == null}">
    <a th:href="@{/CheckLogin}">Login or Register</a>
</div>

<h4>Make order form:</h4>
<div>
    <form action="CreateOrder" method="POST">
        <table>
            <thead>
            <tr>
                <th>Service package</th>
                <th>Validity period</th>
                <th>Optional Products</th>
                <th>Starting date of subscription</th>
            </tr>
            </thead>
            <tr>
                <td>
                    <select id="sp" name="sp" class="select" required>
                        <option th:each="sp, i :${service_packages}" th:id="|sp_${i.index}|" th:value="${sp.getId()}"
                                th:text="${sp.getName()}">
                            Service Package 1
                        </option>
                    </select>
                </td>
                <td>
                    <select id="vp" name="vp" class="select-multiple" required>
                        <option th:each="vp :${val_pers}" th:value="${vp.getId()}"
                                th:text="|${vp.getMonths()} months / ${vp.getFee()} euros|">12 months / 11.99 euros
                        </option>
                    </select>
                </td>
                <td id="td_ops">
                    <select id="ops" name="ops" class="select-multiple" multiple>
                        <option th:each="op :${ops}" th:value="${op.getId()}"
                                th:text="|${op.getName()} (${op.getMonthlyFee()} euros)|">optProd1 (10.99 euros)
                        </option>
                    </select>
                </td>
                <td>
                    <input id="start_date_subscription" type="date" name="start_date_subscription" min="" required>
                </td>
                <script>
                    // in order to have dynamic choosing of optional products or validity periods
                    document.getElementById("sp").addEventListener("change", ev => {
                        let id_sp = parseInt(document.getElementById("sp").value);
                        console.log("clicked on " + id_sp)
                        getServicePackages(id_sp, generateBoxesHome);
                    });
                    getServicePackages(parseInt(document.getElementById("sp").value), generateBoxesHome);

                    // to set the minimum date as today
                    var today = new Date();
                    var dd = today.getDate();
                    var mm = today.getMonth() + 1; //January is 0!
                    var yyyy = today.getFullYear();

                    if (dd < 10) {
                        dd = '0' + dd;
                    }

                    if (mm < 10) {
                        mm = '0' + mm;
                    }

                    document.getElementById("start_date_subscription").setAttribute("min", yyyy + '-' + mm + '-' + dd)
                    document.getElementById("start_date_subscription").setAttribute("value", today)
                </script>
            </tr>
            <tr>
                <td>
                    <input type="hidden" name="submittedForm" value="true">
                    <input type="submit" value="Confirm">
                </td>
            </tr>
        </table>
    </form>
</div>

<h4>Available Service Packages:</h4>
<table>
    <thead>
    <tr>
        <th>Id</th>
        <th>Name</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="sp : ${service_packages}">
        <td th:text="${sp.getId()}"></td>
        <td th:text="${sp.getName()}"></td>
    </tr>
    </tbody>
</table>
<h4>Optional products available:</h4>
<table>
    <thead>
    <tr>
        <th>Id</th>
        <th>Name</th>
        <th>Monthly Fee</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="op : ${ops}">
        <td th:text="${op.getId()}"></td>
        <td th:text="${op.getName()}"></td>
        <td th:text="${op.getMonthlyFee()}"></td>
    </tr>
    </tbody>
</table>
<h4>Validity period available:</h4>
<table>
    <thead>
    <tr>
        <th>Id</th>
        <th>Month</th>
        <th>Fee</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="vp : ${val_pers}">
        <td th:text="${vp.getId()}"></td>
        <td th:text="${vp.getMonths()}"></td>
        <td th:text="${vp.getFee()}"></td>
    </tr>
    </tbody>
</table>

<h4>Services available:</h4>
<table>
    <thead>
    <tr>
        <th>Id</th>
        <th>Type</th>
        <th>Number Of Minutes</th>
        <th>Fee For Minutes</th>
        <th>Number Of SMS</th>
        <th>Fee For SMS</th>
        <th>Number Of Giga</th>
        <th>Fee For Giga</th>

    </tr>
    </thead>
    <tbody>
    <tr th:each="s : ${services}">
        <td th:text="${s.getId()}"></td>
        <td th:text="${s.getType()}"></td>
        <td th:text="${s.getNumberMinutes()}"></td>
        <td th:text="${s.getFeeMinutes()}"></td>
        <td th:text="${s.getNumberSms()}"></td>
        <td th:text="${s.getFeeSms()}"></td>
        <td th:text="${s.getNumberGiga()}"></td>
        <td th:text="${s.getFeeGiga()}"></td>
    </tr>
    </tbody>
</table>
</body>
</html>